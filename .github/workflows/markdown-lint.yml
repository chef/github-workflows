# ---
# on:
#   workflow_call:

# jobs:
#   markdown-lint:
#     runs-on: ubuntu-latest
#     container: ruby:alpine
#     steps:
#       - name: Checkout Code
#         uses: actions/checkout@main
#       - name: Pull Change list
#         id: changed-files
#         uses: collin-miller/git-changesets@master
#       - name: Verify Changed files
#         id: verify-changed-files
#         run: |
#           echo '${{ steps.changed-files.outputs.added_modified }}' > changed.txt
#           if grep ".*\.md" changed.txt; then
#             echo "files_changed=true" >> "$GITHUB_OUTPUT"
#           else
#             echo "files_changed=false" >> "$GITHUB_OUTPUT"
#           fi
#       - name: Run Markdown Linter
#         if: steps.verify-changed-files.outputs.files_changed == 'true'
#         run: |
#           echo '${{ steps.changed-files.outputs.added_modified }}' > changed.txt
#           declare -a mds
#           while read -r f; do
#             if [[ "$f" =~ \.md ]]; then
#               mds+=("$f")
#             fi
#           done <changed.txt
#           if [ ${#mds[@]} -ne 0 ]; then
#             gem install mdl
#             for mdf in "${mds[@]}"; do
#                 mdl "$mdf"
#             done
#           fi

---
on:
  workflow_call:

jobs:
  markdown-lint:
    runs-on: ubuntu-latest
    # container: ruby:alpine
    steps:
      - name: Checkout Code
        # uses: actions/checkout@main
        uses: actions/checkout@v3 # Do we actually need main?
        # with:
        #   fetch-depth: 2 # Ensures we have the history to determine changed files
      - name: Fetch the base branch
        run: git fetch --depth=1 origin ${{ github.base_ref }}
      - name: Get changed markdown files
        id: get-changed-files
        run: |
          files=$(git diff --name-only origin/${{ github.base_ref }}...HEAD -- '*.md')
          echo "files=$files" >> "$GITHUB_OUTPUT"
      - name: Run Markdown Linter
        run: |
          mds="${{ steps.get-changed-files.outputs.files }}"
          if [ ${#mds[@]} -ne 0 ]; then
            gem install mdl
            for mdf in "${mds[@]}"; do
                mdl "$mdf"
            done
          fi